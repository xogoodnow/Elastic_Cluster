---
- name: check connectivity
  ping:
    data: alive

- name: Create Elasticsearch S3 Snapshot Repository
  uri:
    url: "https://{{ ansible_host }}:9200/_snapshot/{{ SNAPSHOT_REGISTRY_NAME }}"
    method: PUT
    user: "elastic"
    password: "{{ ELASTIC_PASSWORD }}"
    body: >
      {
        "type": "s3",
        "settings": {
          "bucket": "{{ SNAPSHOT_BUCKET_NAME }}",
          "endpoint": "{{ SNAPSHOT_S3_ENDPOINT }}"
        }
      }
    body_format: json
    validate_certs: false
    force_basic_auth: true
    status_code: 200
    headers:
      Content-Type: "application/json"
  register: snapshot_repository_created

- name: Print out the result of the request
  # the result must be acknowledged
  debug:
    var: snapshot_repository_created

